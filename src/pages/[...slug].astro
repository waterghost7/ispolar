---
// src/pages/[...slug].astro
import { molecules } from '../moleculesData.js'; // Veriyi src'den Ã§ekiyoruz

// BU FONKSÄ°YON SÄ°HÄ°RÄ° YAPIYOR:
// Astro'ya diyoruz ki: "Listemdeki her molekÃ¼l iÃ§in ve anasayfa iÃ§in birer sayfa Ã¼ret."
export async function getStaticPaths() {
  // 1. Her molekÃ¼l iÃ§in bir rota oluÅŸtur (/h2o, /co2...)
  const moleculeRoutes = molecules.map(mol => ({
    params: { slug: mol.id },
  }));

  // 2. Bir de boÅŸ rota oluÅŸtur (Anasayfa / iÃ§in)
  return [
    { params: { slug: undefined } }, 
    ...moleculeRoutes
  ];
}

// Åžu anki sayfanÄ±n hangisi olduÄŸunu anla
const { slug } = Astro.params;
---

<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5B35M5FSQB"></script>
    <script is:inline>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-5B35M5FSQB');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>Home | IsPolar?</title>
    <meta name="description" content="Instant molecule polarity checker.">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ§ª</text></svg>">

    <style is:global>
            /* 1. RESET VE DEÄžÄ°ÅžKENLER */
            :root {
                --primary-gradient: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
                --bg-body: #f3f4f6;
                --bg-card: #ffffff;
                --text-dark: #1f2937;
                --text-gray: #6b7280;
                --border-color: rgba(0,0,0,0.05);
                --input-bg: #f9fafb;
                --sidebar-width: 350px;
                --shadow-soft: 0 10px 40px -10px rgba(99, 102, 241, 0.15);
                --scroll-thumb: #cbd5e1;
                --scroll-track: #f3f4f6;
            }

            body.dark-mode {
                --bg-body: #0f172a;
                --bg-card: #1e293b;
                --text-dark: #f1f5f9;
                --text-gray: #94a3b8;
                --border-color: #334155;
                --input-bg: #0f172a;
                --shadow-soft: 0 10px 40px -10px rgba(0, 0, 0, 0.5);
                --scroll-thumb: #475569;
                --scroll-track: #0f172a;
                color-scheme: dark;
            }

            *, *::before, *::after {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
                -webkit-tap-highlight-color: transparent;
            }

            /* 2. TEMEL YAPI (HERKES Ä°Ã‡Ä°N ORTAK) */
            html {
                width: 100%;
                /* DÄ°KKAT: Burada height: 100% veya overflow: hidden YOK. */
            }

            body {
                font-family: 'Poppins', sans-serif;
                background-color: var(--bg-body);
                color: var(--text-dark);
                width: 100%;
                /* Flex Ã¶zellikleri aÅŸaÄŸÄ±da sadece masaÃ¼stÃ¼ne verilecek */
            }

            /* =========================================
            MASAÃœSTÃœ GÃ–RÃœNÃœMÃœ (769px ve Ã¼stÃ¼)
            Sayfa kilitleme (overflow: hidden) SADECE BURADA
            ========================================= */
            @media (min-width: 769px) {
                html, body {
                    height: 100%;
                    overflow: hidden; /* Sadece PC'de kilitli */
                }

                body {
                    display: flex;
                    flex-direction: row;
                }

                .sidebar {
                    height: 100%;
                    overflow: hidden;
                    display: flex; 
                    flex-direction: column;
                }

                .main-content {
                    height: 100%;
                    overflow-y: auto; /* Ä°Ã§erik burada kayar */
                }
            }

            /* =========================================
            MOBÄ°L GÃ–RÃœNÃœMÃœ (768px ve altÄ±)
            Burada her ÅŸey doÄŸal akÄ±ÅŸÄ±na bÄ±rakÄ±ldÄ±.
            ========================================= */
            @media (max-width: 768px) {
                html, body {
                    height: auto;
                    min-height: 100vh;
                    overflow-x: hidden;
                    overflow-y: auto; /* Mobilde ana scroll serbest */
                }

                body {
                    display: block;
                    padding-top: 60px;
                    position: relative;
                }

                .main-content {
                    height: auto;
                    overflow: visible; /* Ä°Ã§ kilit yok */
                    display: block;
                }
            }

            /* --- BÄ°LEÅžENLER --- */
            
            /* DARK MODE BUTONU */
            .theme-btn {
                position: fixed; bottom: 20px; right: 20px; width: 50px; height: 50px;
                border-radius: 50%; border: none; background: var(--bg-card); color: var(--text-dark);
                font-size: 1.5rem; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                z-index: 2000; display: flex; align-items: center; justify-content: center;
                transition: transform 0.2s, background-color 0.3s;
            }
            .theme-btn:hover { transform: scale(1.1); }

            /* SIDEBAR GENEL */
            .sidebar {
                width: var(--sidebar-width);
                min-width: var(--sidebar-width);
                background: var(--bg-card);
                border-right: 1px solid var(--border-color);
                z-index: 1000;
                position: relative;
                box-shadow: 5px 0 25px rgba(0,0,0,0.03);
                transition: transform 0.3s ease;
            }

            /* SEARCH INPUT */
            .search-wrapper { padding: 20px 25px; background: var(--bg-card); position: sticky; top: 0; z-index: 50; }
            .search-container { position: relative; width: 100%; }
            .search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); width: 18px; height: 18px; border: 2px solid #9ca3af; border-radius: 50%; }
            .search-icon::after { content: ''; position: absolute; right: -5px; bottom: -5px; width: 6px; height: 2px; background: #9ca3af; transform: rotate(45deg); }
            
            .search-wrapper input {
                width: 100%; padding: 14px 20px 14px 45px; border-radius: 50px;
                border: 2px solid var(--bg-body); background: var(--input-bg);
                font-size: 15px; font-weight: 500; color: var(--text-dark); outline: none; transition: all 0.3s ease;
            }
            .search-wrapper input:focus { background: var(--bg-card); border-color: #818cf8; box-shadow: 0 4px 15px rgba(99, 102, 241, 0.15); }

            .molecule-list { flex: 1; overflow-y: auto; padding: 10px 15px 40px 15px; }

            /* MOLECULE ITEM */
            :global(.molecule-item) { padding: 16px 20px; margin-bottom: 8px; border-radius: 12px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; border: 1px solid transparent; }
            :global(.molecule-item:hover) { background-color: var(--bg-body); transform: translateX(5px); }
            :global(.molecule-item.active) { background: var(--primary-gradient); color: white; box-shadow: 0 8px 20px -5px rgba(99, 102, 241, 0.4); }
            :global(.molecule-item span.formula) { font-weight: 700; font-size: 1.1rem; color: var(--text-dark); }
            :global(.molecule-item.active span.formula) { color: white; }
            :global(.molecule-item span.name) { font-size: 0.85rem; color: var(--text-gray); font-weight: 500;}
            :global(.molecule-item.active span.name) { color: rgba(255,255,255,0.8); }

            /* ANA Ä°Ã‡ERÄ°K */
            .main-content {
                flex: 1;
                padding: 40px;
                display: flex; flex-direction: column; align-items: center;
            }

            .card {
                background: var(--bg-card); width: 100%; max-width: 800px; min-height: 600px;
                border-radius: 24px; box-shadow: var(--shadow-soft); padding: 40px;
                border: 1px solid var(--border-color); margin-bottom: 50px; transition: background-color 0.3s;
            }

            .image-container {
                width: 100%; height: 320px;
                background: var(--bg-body); border-radius: 20px;
                display: flex; align-items: center; justify-content: center;
                margin-bottom: 30px; border: 2px dashed var(--border-color);
                position: relative; overflow: hidden;
            }
            .image-container img { max-width: 90%; max-height: 90%; object-fit: contain; }

            .seo-footer {
                width: 100%; max-width: 800px; background: var(--bg-card); padding: 25px;
                border-radius: 16px; text-align: center; box-shadow: 0 5px 20px rgba(0,0,0,0.03); margin-top: auto;
            }
            .seo-table { width: 100%; margin-top: 15px; border-collapse: collapse; text-align: left; }
            .seo-table th { color: #8b5cf6; font-size: 0.8rem; padding: 10px; }
            .seo-table td { font-size: 0.9rem; padding: 10px; border-bottom: 1px solid var(--border-color); color: var(--text-dark); }

            .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 900; opacity: 0; transition: opacity 0.3s; }
            .overlay.active { display: block; opacity: 1; }

            /* SCROLLBAR */
            ::-webkit-scrollbar { width: 8px; }
            ::-webkit-scrollbar-track { background: var(--scroll-track); }
            ::-webkit-scrollbar-thumb { background-color: var(--scroll-thumb); border-radius: 20px; }
            html { scrollbar-width: thin; scrollbar-color: var(--scroll-thumb) var(--scroll-track); }

            /* MOBÄ°L Ã–ZEL AYARLAR (NAVBAR VB.) */
            @media (max-width: 768px) {
                .mobile-nav { 
                    display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 60px;
                    background: var(--bg-card); z-index: 500; padding: 0 20px;
                    align-items: center; justify-content: space-between;
                    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
                }
                .hamburger-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-dark); padding: 5px; }
                .mobile-logo { font-weight: 700; font-size: 1.2rem; background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

                .sidebar {
                    position: fixed; top: 0; left: 0; height: 100%; width: 80%; max-width: 320px;
                    transform: translateX(-100%);
                    box-shadow: 5px 0 30px rgba(0,0,0,0.2);
                }
                .sidebar.open { transform: translateX(0); }

                .search-wrapper { border-radius: 0; }
                .molecule-list { padding-bottom: 80px; }
                .main-content { padding: 20px 15px; }
                .card { padding: 25px; border-radius: 20px; min-height: auto; }
                .seo-table { display: none; }
            }
        </style>
</head>
<body>

    <button id="themeToggle" class="theme-btn" aria-label="Toggle Dark Mode">ðŸŒ™</button>

    <nav class="mobile-nav">
        <button class="hamburger-btn" id="menuBtn">â˜°</button>
        <span class="mobile-logo">IsPolar?</span>
        <div style="width: 24px;"></div> 
    </nav>

    <div class="overlay" id="overlay"></div>

    <aside class="sidebar" id="sidebar">
        <div class="search-wrapper">
            <div class="search-container">
                <div class="search-icon"></div>
                <input type="text" id="searchInput" placeholder="Search molecule...">
            </div>
        </div>
        <div class="molecule-list" id="moleculeList"></div>
        <div class="scroll-indicator" id="scrollIndicator">
            <span>Scroll for more â†“</span>
        </div>
    </aside>

    <main class="main-content">
        <article class="card" id="detailCard">
            <div style="text-align:center; padding:50px; color:#6b7280;">
                <h2>Welcome to IsPolar?</h2>
                <p>Select a molecule from the list to see details.</p>
            </div>
        </article>
        
    </main>

    <script is:inline src="/molecules.js"></script>

    <style>
        .mobile-nav { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 60px; background: var(--bg-card); z-index: 500; padding: 0 20px; align-items: center; justify-content: space-between; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .hamburger-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-dark); padding: 5px; }
        .mobile-logo { font-weight: 700; font-size: 1.2rem; background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .sidebar { width: var(--sidebar-width); background: var(--bg-card); border-right: 1px solid var(--border-color); display: flex; flex-direction: column; flex-shrink: 0; z-index: 1000; position: relative; box-shadow: 5px 0 25px rgba(0,0,0,0.03); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), background-color 0.3s; }
        .search-wrapper { padding: 20px 25px; background: var(--bg-card); position: sticky; top: 0; z-index: 50; transition: background-color 0.3s; }
        .search-container { position: relative; width: 100%; }
        .search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); width: 18px; height: 18px; border: 2px solid #9ca3af; border-radius: 50%; }
        .search-icon::after { content: ''; position: absolute; right: -5px; bottom: -5px; width: 6px; height: 2px; background: #9ca3af; transform: rotate(45deg); }
        
        .search-wrapper input { width: 100%; padding: 14px 20px 14px 45px; border-radius: 50px; border: 2px solid var(--bg-body); background: var(--input-bg); font-size: 15px; font-weight: 500; color: var(--text-dark); outline: none; transition: all 0.3s ease; }
        .search-wrapper input:focus { background: var(--bg-card); border-color: #818cf8; box-shadow: 0 4px 15px rgba(99, 102, 241, 0.15); }
        .molecule-list { flex: 1; overflow-y: auto; padding: 10px 15px 40px 15px; }
        
        .scroll-indicator { display: none; position: absolute; bottom: 0; left: 0; width: 100%; height: 70px; background: linear-gradient(to top, var(--bg-card) 40%, rgba(255,255,255,0)); justify-content: center; align-items: flex-end; padding-bottom: 15px; pointer-events: none; z-index: 60; transition: opacity 0.3s ease; border-radius: 0 0 25px 25px; }
        .scroll-indicator span { font-size: 0.75rem; color: #8b5cf6; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; background: var(--bg-card); padding: 8px 16px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-5px);} 60% {transform: translateY(-3px);} }
        
        .main-content { flex: 1; overflow-y: auto; padding: 40px; display: flex; flex-direction: column; align-items: center; }
        .card { background: var(--bg-card); width: 100%; max-width: 800px; min-height: 600px; border-radius: 24px; box-shadow: var(--shadow-soft); padding: 40px; border: 1px solid var(--border-color); margin-bottom: 30px; transition: background-color 0.3s; }
        .seo-footer { width: 100%; max-width: 800px; background: var(--bg-card); padding: 25px; border-radius: 16px; text-align: center; box-shadow: 0 5px 20px rgba(0,0,0,0.03); margin-top: auto; transition: background-color 0.3s; }
        .seo-table { width: 100%; margin-top: 15px; border-collapse: collapse; text-align: left; }
        .seo-table th { color: #8b5cf6; font-size: 0.8rem; padding: 10px; }
        .seo-table td { font-size: 0.9rem; padding: 10px; border-bottom: 1px solid var(--border-color); color: var(--text-dark); }
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 900; opacity: 0; transition: opacity 0.3s; }
        .overlay.active { display: block; opacity: 1; }

        :global(.molecule-item) { padding: 16px 20px; margin-bottom: 8px; border-radius: 12px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; border: 1px solid transparent; }
        :global(.molecule-item:hover) { background-color: var(--bg-body); transform: translateX(5px); }
        :global(.molecule-item.active) { background: var(--primary-gradient); color: white; box-shadow: 0 8px 20px -5px rgba(99, 102, 241, 0.4); }
        :global(.molecule-item span.formula) { font-weight: 700; font-size: 1.1rem; color: var(--text-dark); }
        :global(.molecule-item.active span.formula) { color: white; }
        :global(.molecule-item span.name) { font-size: 0.85rem; color: var(--text-gray); font-weight: 500;}
        :global(.molecule-item.active span.name) { color: rgba(255,255,255,0.8); }

        @media (max-width: 768px) {
            body { flex-direction: column; overflow: auto; height: auto; padding-top: 60px; }
            .mobile-nav { display: flex; }
            .sidebar { position: fixed; top: 0; left: 0; height: 100%; width: 80%; max-width: 320px; transform: translateX(-100%); box-shadow: 5px 0 30px rgba(0,0,0,0.2); }
            .sidebar.open { transform: translateX(0); }
            .search-wrapper { border-radius: 0; }
            .molecule-list { padding-bottom: 80px; }
            .scroll-indicator { display: flex; }
            .main-content { padding: 20px 15px; }
            .card { padding: 25px; border-radius: 20px; }
            .seo-table { display: none; }
        }
    </style>

    <script is:inline>
        // DARK MODE
        const themeBtn = document.getElementById('themeToggle');
        const currentTheme = localStorage.getItem('theme');
        if (currentTheme === 'dark') { document.body.classList.add('dark-mode'); if(themeBtn) themeBtn.textContent = 'â˜€ï¸'; }
        if(themeBtn) {
            themeBtn.addEventListener('click', () => {
                document.body.classList.toggle('dark-mode');
                if (document.body.classList.contains('dark-mode')) { localStorage.setItem('theme', 'dark'); themeBtn.textContent = 'â˜€ï¸'; } 
                else { localStorage.setItem('theme', 'light'); themeBtn.textContent = 'ðŸŒ™'; }
            });
        }

        // ELEMENTLER
        const listContainer = document.getElementById('moleculeList');
        const detailCard = document.getElementById('detailCard');
        const searchInput = document.getElementById('searchInput');
        const seoTableBody = document.getElementById('seoTableBody');
        const scrollIndicator = document.getElementById('scrollIndicator');
        const menuBtn = document.getElementById('menuBtn');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');

        // MENÃœ
        function toggleMenu() { sidebar.classList.toggle('open'); overlay.classList.toggle('active'); }
        function closeMenu() { sidebar.classList.remove('open'); overlay.classList.remove('active'); }
        if(menuBtn) menuBtn.addEventListener('click', toggleMenu);
        if(overlay) overlay.addEventListener('click', closeMenu);

        // SCROLL
        function handleScroll() {
            if (listContainer.scrollTop > 10) scrollIndicator.style.opacity = '0';
            else scrollIndicator.style.opacity = '1';
        }
        if(listContainer) listContainer.addEventListener('scroll', handleScroll);

        // SEO TABLOSU
        function fillSeoTable() {
            if(!seoTableBody) return; 
        
        	seoTableBody.innerHTML = "";
        	if (typeof molecules !== 'undefined') {
            molecules.forEach(mol => {
                const row = document.createElement('tr');
                row.innerHTML = `<td><strong>${mol.formula}</strong></td><td>${mol.polarity}</td><td>${mol.geometry}</td>`;
                seoTableBody.appendChild(row);
            });
        }
        }

        // LÄ°STE Render
        function renderList(filterText = "") {
            if(!listContainer) return;
            listContainer.innerHTML = "";
            if (typeof molecules === 'undefined') {
                listContainer.innerHTML = `<div style="padding:20px">Error: molecules.js not loaded</div>`;
                return;
            }

            const filtered = molecules.filter(m => 
                m.formula.toLowerCase().includes(filterText.toLowerCase()) || 
                m.name.toLowerCase().includes(filterText.toLowerCase())
            );

            if (filtered.length === 0) {
                listContainer.innerHTML = `<div style="padding:30px; color:var(--text-gray); text-align:center;">No molecule found ðŸ§ª</div>`;
                return;
            }

            filtered.forEach((mol) => {
                const item = document.createElement('div');
                item.id = `item-${mol.id}`;
                item.className = 'molecule-item';
                item.onclick = () => {
                    updateURL(mol.id);
                    showDetail(mol, item, true);
                    if (window.innerWidth <= 768) closeMenu();
                };
                item.innerHTML = `<span class="formula">${mol.formula}</span><span class="name">${mol.name}</span>`;
                listContainer.appendChild(item);
            });
        }

        function showDetail(mol, element, scroll = false) {
            document.querySelectorAll('.molecule-item').forEach(el => el.classList.remove('active'));
            if(element) element.classList.add('active');

            document.title = `Is ${mol.formula} Polar? - ${mol.name}`;
            const badgeClass = mol.polarity === "Polar" ? "polar" : "nonpolar";
            
            detailCard.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                    <h1 style="font-size: 2.5rem; background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 800; margin:0;">
                        ${mol.formula} <span style="font-size:1.2rem; color:var(--text-gray); font-weight:400; margin-left:10px">(${mol.name})</span>
                    </h1>
                    <span class="badge ${badgeClass}" style="padding: 8px 20px; border-radius: 50px; font-weight: 700; font-size: 0.9rem; text-transform: uppercase; ${badgeClass === 'polar' ? 'background: #fee2e2; color: #dc2626;' : 'background: #dcfce7; color: #16a34a;'}">${mol.polarity}</span>
                </div>
                <div class="image-container" style="width: 100%; height: 320px; background: var(--bg-body); border-radius: 20px; display: flex; align-items: center; justify-content: center; margin-bottom: 30px; border: 2px dashed var(--border-color);">
                    <img src="img/${mol.id}.webp" width="600" height="400" loading="lazy" decoding="async" style="max-width: 90%; max-height: 90%; object-fit: contain;" alt="${mol.name} Lewis Structure" onerror="this.src='https://placehold.co/600x400?text=No+Image'">
                </div>
                <div class="grid-info" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 35px;">
                    <div class="info-box" style="background: var(--bg-body); padding: 15px; border-radius: 16px; text-align: center; border: 1px solid var(--border-color);">
                        <h3 style="font-size: 0.7rem; color: #8b5cf6; margin-bottom: 8px; font-weight: 700;">GEOMETRY</h3><p style="font-size: 1.1rem; font-weight: 700;">${mol.geometry}</p>
                    </div>
                    <div class="info-box" style="background: var(--bg-body); padding: 15px; border-radius: 16px; text-align: center; border: 1px solid var(--border-color);">
                        <h3 style="font-size: 0.7rem; color: #8b5cf6; margin-bottom: 8px; font-weight: 700;">ANGLE</h3><p style="font-size: 1.1rem; font-weight: 700;">${mol.angle}</p>
                    </div>
                    <div class="info-box" style="background: var(--bg-body); padding: 15px; border-radius: 16px; text-align: center; border: 1px solid var(--border-color);">
                        <h3 style="font-size: 0.7rem; color: #8b5cf6; margin-bottom: 8px; font-weight: 700;">HYBRIDIZATION</h3><p style="font-size: 1.1rem; font-weight: 700;">${mol.hybridization}</p>
                    </div>
                    <div class="info-box" style="background: var(--bg-body); padding: 15px; border-radius: 16px; text-align: center; border: 1px solid var(--border-color);">
                        <h3 style="font-size: 0.7rem; color: #8b5cf6; margin-bottom: 8px; font-weight: 700;">POLARITY</h3><p style="font-size: 1.1rem; font-weight: 700;">${mol.polarity}</p>
                    </div>
                </div>
                <div class="description" style="line-height: 1.8; color: var(--text-gray); font-size: 1.05rem; background: var(--bg-body); padding: 25px; border-radius: 16px; border-left: 5px solid #8b5cf6;">
                    <h3 style="margin-bottom: 10px; color: var(--text-dark);">Why is it ${mol.polarity}?</h3><p>${mol.description}</p>
                </div>
            `;
            if (window.innerWidth <= 768 && scroll) window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateURL(id) { window.history.pushState({id: id}, '', '/' + id); }

        function handleRouting() {
            if (typeof molecules === 'undefined') return;
            let path = window.location.pathname.substring(1).toLowerCase();
            renderList(); fillSeoTable();
            if (path) {
                const targetMol = molecules.find(m => m.id === path);
                if (targetMol) {
                    setTimeout(() => {
                        const targetItem = document.getElementById(`item-${targetMol.id}`);
                        showDetail(targetMol, targetItem, false);
                    }, 0);
                }
            } else {
                 const firstMol = molecules[0];
                 setTimeout(() => {
                    const firstItem = document.getElementById(`item-${firstMol.id}`);
                    showDetail(firstMol, firstItem, false);
                }, 0);
            }
        }

        if(searchInput) searchInput.addEventListener('input', (e) => renderList(e.target.value));
        window.addEventListener('popstate', handleRouting);
        document.addEventListener('DOMContentLoaded', () => { setTimeout(handleRouting, 100); });
    </script>

</body>
</html>